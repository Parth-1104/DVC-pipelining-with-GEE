schema: '2.0'
stages:
  fetch_data:
    cmd: python src/fetch_data.py 2023-12-01 2024-04-25 sentinel2_raw.csv
    deps:
    - path: src/config.py
      hash: md5
      md5: b08c5b99afd41d84cf5f94f284fd2d69
      size: 1048
    - path: src/fetch_data.py
      hash: md5
      md5: c85f8a60464c1fbd2ad975fe164798b8
      size: 3295
    params:
      params.yaml:
        data.end_date: '2024-04-25'
        data.start_date: '2023-12-01'
    outs:
    - path: data/raw/sentinel2_raw.csv
      hash: md5
      md5: e1c7588662b9bd8e1ebb8614a50eddf9
      size: 1733
  validate_data:
    cmd: python src/validate_data.py sentinel2_raw.csv sentinel2_validated.csv
    deps:
    - path: data/raw/sentinel2_raw.csv
      hash: md5
      md5: e1c7588662b9bd8e1ebb8614a50eddf9
      size: 1733
    - path: src/validate_data.py
      hash: md5
      md5: 2854aba412786c05fdf81f537502a721
      size: 3620
    outs:
    - path: data/raw/sentinel2_validated.csv
      hash: md5
      md5: 222d362bedf990c5f1bd58c586ca8729
      size: 1681
  preprocess:
    cmd: python src/preprocess.py sentinel2_validated.csv processed_features.csv
      scaler.pkl
    deps:
    - path: data/raw/sentinel2_validated.csv
      hash: md5
      md5: 222d362bedf990c5f1bd58c586ca8729
      size: 1681
    - path: src/preprocess.py
      hash: md5
      md5: 52e5bee02354a607afc2248028fd1918
      size: 2073
    outs:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 7dcdde51fc257bb5fb783c92313ae11c
      size: 2896
    - path: models/trained_models/scaler.pkl
      hash: md5
      md5: 01152c28c92d00abd76f6c3add44669e
      size: 618
  generate_labels:
    cmd: python src/generate_labels.py processed_features.csv labels.csv
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 7dcdde51fc257bb5fb783c92313ae11c
      size: 2896
    - path: src/generate_labels.py
      hash: md5
      md5: 2da96550dde5d4c4d4686a44e08fe1df
      size: 4048
    outs:
    - path: data/processed/labels.csv
      hash: md5
      md5: d41962b240dcb75d044f6f658c56f1d7
      size: 3604
  train:
    cmd: python src/train.py params.yaml
    deps:
    - path: data/processed/labels.csv
      hash: md5
      md5: d41962b240dcb75d044f6f658c56f1d7
      size: 3604
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 7dcdde51fc257bb5fb783c92313ae11c
      size: 2896
    - path: src/config.py
      hash: md5
      md5: b08c5b99afd41d84cf5f94f284fd2d69
      size: 1048
    - path: src/generate_labels.py
      hash: md5
      md5: 2da96550dde5d4c4d4686a44e08fe1df
      size: 4048
    - path: src/model.py
      hash: md5
      md5: 196e09820b432fa3330bf94877600673
      size: 6484
    - path: src/train.py
      hash: md5
      md5: 98b98c5ae050674095bcc4e395eac602
      size: 8877
    params:
      params.yaml:
        model:
          type: hydrotransnet
          seq_len: 3
          d_model: 128
          nhead: 4
          num_encoder_layers: 8
          dim_feedforward: 512
          dropout: 0.01
          learning_rate: 0.001
          epochs: 100
          batch_size: 4
    outs:
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: 760002728f214587122cc6a61d82d2a1
      size: 9066300
    - path: models/trained_models/training_history.pkl
      hash: md5
      md5: dd8f7e46d767e1fd32ba335c69cedbbd
      size: 336
  evaluate:
    cmd: python src/evaluate.py params.yaml
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 7dcdde51fc257bb5fb783c92313ae11c
      size: 2896
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: 760002728f214587122cc6a61d82d2a1
      size: 9066300
    - path: src/evaluate.py
      hash: md5
      md5: 6de66efd2f00ef26c834b2e03c2c5439
      size: 6154
    outs:
    - path: models/trained_models/evaluation_metrics.pkl
      hash: md5
      md5: a9a0750418787f87278cdc7d03bb97c2
      size: 415
    - path: models/trained_models/predictions.png
      hash: md5
      md5: db9331cb6662f91aca84fb5f0cdf4e4f
      size: 182607
    - path: models/trained_models/residuals.png
      hash: md5
      md5: 227099565a8cc65039dcd25d37a78e86
      size: 142160
    - path: models/trained_models/test_predictions.csv
      hash: md5
      md5: 009dc755f1e4a21579097d70011df035
      size: 238
  predict:
    cmd: python src/predict.py
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 7dcdde51fc257bb5fb783c92313ae11c
      size: 2896
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: 760002728f214587122cc6a61d82d2a1
      size: 9066300
    - path: src/model.py
      hash: md5
      md5: 196e09820b432fa3330bf94877600673
      size: 6484
    - path: src/predict.py
      hash: md5
      md5: 235366e7abdff9911aa8ea13a8a862cb
      size: 2799
    outs:
    - path: models/trained_models/new_predictions.csv
      hash: md5
      md5: bf6fc9e446a3b068f467742848cde79f
      size: 831
