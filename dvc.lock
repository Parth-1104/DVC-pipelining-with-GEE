schema: '2.0'
stages:
  fetch_data:
    cmd: python src/fetch_data.py 2010-05-01 2025-10-25 sentinel2_raw.csv
    deps:
    - path: src/config.py
      hash: md5
      md5: 8422ccc6464bc7dae5511b538e72bbe2
      size: 916
    - path: src/fetch_data.py
      hash: md5
      md5: d960d16e876924fff6f50c102d32186a
      size: 2747
    params:
      params.yaml:
        data.end_date: '2025-10-25'
        data.start_date: '2010-05-01'
    outs:
    - path: data/raw/sentinel2_raw.csv
      hash: md5
      md5: 91770d7f84bf5296b4946e13870e8726
      size: 37478
  validate_data:
    cmd: python src/validate_data.py sentinel2_raw.csv sentinel2_validated.csv
    deps:
    - path: data/raw/sentinel2_raw.csv
      hash: md5
      md5: 91770d7f84bf5296b4946e13870e8726
      size: 37478
    - path: src/validate_data.py
      hash: md5
      md5: 2854aba412786c05fdf81f537502a721
      size: 3620
    outs:
    - path: data/raw/sentinel2_validated.csv
      hash: md5
      md5: 6305f71790d553e398da34f92a73fa59
      size: 36369
  preprocess:
    cmd: python src/preprocess.py sentinel2_validated.csv processed_features.csv
      scaler.pkl
    deps:
    - path: data/raw/sentinel2_validated.csv
      hash: md5
      md5: 6305f71790d553e398da34f92a73fa59
      size: 36369
    - path: src/preprocess.py
      hash: md5
      md5: b890b00c6ec29287709eff23709e5902
      size: 2158
    outs:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 720db6d5347fbf94016dc70850cc04f1
      size: 62065
    - path: models/trained_models/scaler.pkl
      hash: md5
      md5: b1312e9e5b5930e742a267ba5a6f7b72
      size: 762
  generate_labels:
    cmd: python src/generate_labels.py processed_features.csv labels.csv
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 720db6d5347fbf94016dc70850cc04f1
      size: 62065
    - path: src/generate_labels.py
      hash: md5
      md5: b5a3358bd29745bdddc441e88438e1a1
      size: 3918
    outs:
    - path: data/processed/labels.csv
      hash: md5
      md5: 9273700dac6217f93c0e4e4f141c770e
      size: 81802
  train:
    cmd: python src/train.py params.yaml
    deps:
    - path: data/processed/features_for_training.csv
      hash: md5
      md5: 0187db684dbbf2dec6faafdbb5a609f6
      size: 63205
    - path: data/processed/labels_for_training.csv
      hash: md5
      md5: 6f79f6cc3a23cac78273b3a7fc2316f7
      size: 27407
    - path: src/config.py
      hash: md5
      md5: 8422ccc6464bc7dae5511b538e72bbe2
      size: 916
    - path: src/generate_labels.py
      hash: md5
      md5: b5a3358bd29745bdddc441e88438e1a1
      size: 3918
    - path: src/model.py
      hash: md5
      md5: e98df45df19d0dce7a21b02c877f1105
      size: 6518
    - path: src/train.py
      hash: md5
      md5: b97df5c5cb9f019a263364b501b6f618
      size: 8171
    params:
      params.yaml:
        model:
          type: hydrotransnet
          seq_len: 3
          d_model: 128
          nhead: 4
          num_encoder_layers: 8
          dim_feedforward: 512
          dropout: 0.01
          learning_rate: 0.001
          epochs: 100
          batch_size: 4
    outs:
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: 6d27b3586d7b7a68b14ed80f835e52ec
      size: 9334468
    - path: models/trained_models/training_history.pkl
      hash: md5
      md5: e34fe4bd6a3d6757cbe06b86329bbe68
      size: 1848
  evaluate:
    cmd: python src/evaluate.py params.yaml
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 720db6d5347fbf94016dc70850cc04f1
      size: 62065
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: 6d27b3586d7b7a68b14ed80f835e52ec
      size: 9334468
    - path: src/evaluate.py
      hash: md5
      md5: 6de66efd2f00ef26c834b2e03c2c5439
      size: 6154
    outs:
    - path: models/trained_models/evaluation_metrics.pkl
      hash: md5
      md5: e383a18178521c0a9600a17f5912961c
      size: 415
    - path: models/trained_models/predictions.png
      hash: md5
      md5: b262921bf5eebebf4d0894ea2788ac2f
      size: 278628
    - path: models/trained_models/residuals.png
      hash: md5
      md5: ed7a2c43639d9cb868e3aab734a60073
      size: 254976
    - path: models/trained_models/test_predictions.csv
      hash: md5
      md5: c3b2a74a97cd0eebcd8d8e88fc3d1e06
      size: 2052
  predict:
    cmd: python src/predict.py
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 720db6d5347fbf94016dc70850cc04f1
      size: 62065
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: 6d27b3586d7b7a68b14ed80f835e52ec
      size: 9334468
    - path: src/model.py
      hash: md5
      md5: e98df45df19d0dce7a21b02c877f1105
      size: 6518
    - path: src/predict.py
      hash: md5
      md5: 017bd10a163e58e03d946b5b814f8795
      size: 3133
    outs:
    - path: models/trained_models/new_predictions.csv
      hash: md5
      md5: 126e493c123177e75dc6a15a9a49511e
      size: 33361
  pretrain:
    cmd: python src/pretrain.py data/processed/processed_features.csv 
      data/processed/labels.csv data/processed/features_for_training.csv 
      data/processed/labels_for_training.csv data/processed/feature_scaler.pkl
    deps:
    - path: data/processed/labels.csv
      hash: md5
      md5: 9273700dac6217f93c0e4e4f141c770e
      size: 81802
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 720db6d5347fbf94016dc70850cc04f1
      size: 62065
    - path: src/pretrain.py
      hash: md5
      md5: b9a27410dcca7bb7e854efbb587001ba
      size: 2811
    outs:
    - path: data/processed/feature_scaler.pkl
      hash: md5
      md5: 73f61bbb4d322beaf9de6270357291b6
      size: 767
    - path: data/processed/features_for_training.csv
      hash: md5
      md5: 0187db684dbbf2dec6faafdbb5a609f6
      size: 63205
    - path: data/processed/labels_for_training.csv
      hash: md5
      md5: 6f79f6cc3a23cac78273b3a7fc2316f7
      size: 27407
