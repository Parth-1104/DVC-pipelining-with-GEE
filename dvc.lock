schema: '2.0'
stages:
  fetch_data:
    cmd: python src/fetch_data.py 2023-12-01 2024-04-25 sentinel2_raw.csv
    deps:
    - path: src/config.py
      hash: md5
      md5: 9ebe42495b55bc697fd19fd9e6fb672d
      size: 940
    - path: src/fetch_data.py
      hash: md5
      md5: c85f8a60464c1fbd2ad975fe164798b8
      size: 3295
    params:
      params.yaml:
        data.end_date: '2024-04-25'
        data.start_date: '2023-12-01'
    outs:
    - path: data/raw/sentinel2_raw.csv
      hash: md5
      md5: 312cecb2913d41f901ba688d7dd4cba1
      size: 2182
  validate_data:
    cmd: python src/validate_data.py sentinel2_raw.csv sentinel2_validated.csv
    deps:
    - path: data/raw/sentinel2_raw.csv
      hash: md5
      md5: 312cecb2913d41f901ba688d7dd4cba1
      size: 2182
    - path: src/validate_data.py
      hash: md5
      md5: 93c29aa27c3a1e978bab2c2b0b25027c
      size: 3626
    outs:
    - path: data/raw/sentinel2_validated.csv
      hash: md5
      md5: d2d04067f5198209942938639aba82f1
      size: 2110
  preprocess:
    cmd: python src/preprocess.py sentinel2_validated.csv processed_features.csv
      scaler.pkl
    deps:
    - path: data/raw/sentinel2_validated.csv
      hash: md5
      md5: d2d04067f5198209942938639aba82f1
      size: 2110
    - path: src/preprocess.py
      hash: md5
      md5: 52e5bee02354a607afc2248028fd1918
      size: 2073
    outs:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: d5d2d1e54d99e9753d00bca5aef8e0ac
      size: 1993
    - path: models/trained_models/scaler.pkl
      hash: md5
      md5: 5dc5427fdd0295dc9b85ccdbdeab179e
      size: 618
  generate_labels:
    cmd: python src/generate_labels.py processed_features.csv labels.csv
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: d5d2d1e54d99e9753d00bca5aef8e0ac
      size: 1993
    - path: src/generate_labels.py
      hash: md5
      md5: 395eb4eca8bb7fc3522df24b3bf55435
      size: 585
    outs:
    - path: data/processed/labels.csv
      hash: md5
      md5: 8e9cdec6ceff0d5988ee4ef416cf146d
      size: 888
  train:
    cmd: python src/train.py params.yaml
    deps:
    - path: data/processed/labels.csv
      hash: md5
      md5: 8e9cdec6ceff0d5988ee4ef416cf146d
      size: 888
    - path: data/processed/processed_features.csv
      hash: md5
      md5: d5d2d1e54d99e9753d00bca5aef8e0ac
      size: 1993
    - path: src/config.py
      hash: md5
      md5: 9ebe42495b55bc697fd19fd9e6fb672d
      size: 940
    - path: src/generate_labels.py
      hash: md5
      md5: 395eb4eca8bb7fc3522df24b3bf55435
      size: 585
    - path: src/model.py
      hash: md5
      md5: 4c052ea5a9c7724f38ce592e01ca4e05
      size: 4407
    - path: src/train.py
      hash: md5
      md5: 1f0e922df2a84100f89c7967b6e98b68
      size: 8282
    params:
      params.yaml:
        model:
          type: hydrotransnet
          seq_len: 3
          d_model: 128
          nhead: 8
          num_encoder_layers: 4
          dim_feedforward: 512
          dropout: 0.1
          learning_rate: 0.001
          epochs: 100
          batch_size: 4
    outs:
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: d1da726fa3b9cdb9c1e019a39c655c94
      size: 12456754
    - path: models/trained_models/training_history.pkl
      hash: md5
      md5: d1205c18664e175b7f3317f81fb7a089
      size: 804
  evaluate:
    cmd: python src/evaluate.py params.yaml
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: d5d2d1e54d99e9753d00bca5aef8e0ac
      size: 1993
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: d1da726fa3b9cdb9c1e019a39c655c94
      size: 12456754
    - path: src/evaluate.py
      hash: md5
      md5: 1f198e7855b3f965081a7f979848771c
      size: 6218
    outs:
    - path: models/trained_models/evaluation_metrics.pkl
      hash: md5
      md5: aad899509f38133908a0dc8f9e2ff43a
      size: 415
    - path: models/trained_models/predictions.png
      hash: md5
      md5: 4d38934f8c997a13d30f80e40063cbb0
      size: 142158
    - path: models/trained_models/residuals.png
      hash: md5
      md5: d0b2e13bb7002f4894494290413827e5
      size: 119847
    - path: models/trained_models/test_predictions.csv
      hash: md5
      md5: b4ca6e01b5e31a7092e962626cc5cf8b
      size: 55
  predict:
    cmd: python src/predict.py
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: d5d2d1e54d99e9753d00bca5aef8e0ac
      size: 1993
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: d1da726fa3b9cdb9c1e019a39c655c94
      size: 12456754
    - path: src/model.py
      hash: md5
      md5: 4c052ea5a9c7724f38ce592e01ca4e05
      size: 4407
    - path: src/predict.py
      hash: md5
      md5: 609f535483f1a2dc4af20b88d99ff47e
      size: 2566
    outs:
    - path: models/trained_models/new_predictions.csv
      hash: md5
      md5: ec5f89048593aba680f9e7887e12457f
      size: 399
