schema: '2.0'
stages:
  fetch_data:
    cmd: python src/fetch_data.py 2010-04-01 2025-10-25 sentinel2_raw.csv
    deps:
    - path: src/config.py
      hash: md5
      md5: ea3d905271b3c244627ea217f1f0eab8
      size: 946
    - path: src/fetch_data.py
      hash: md5
      md5: d960d16e876924fff6f50c102d32186a
      size: 2747
    params:
      params.yaml:
        data.end_date: '2025-10-25'
        data.start_date: '2010-04-01'
    outs:
    - path: data/raw/sentinel2_raw.csv
      hash: md5
      md5: 231c1d133fe2c44377dc80601deb80c7
      size: 76322
  validate_data:
    cmd: python src/validate_data.py sentinel2_raw.csv sentinel2_validated.csv
    deps:
    - path: data/raw/sentinel2_raw.csv
      hash: md5
      md5: 231c1d133fe2c44377dc80601deb80c7
      size: 76322
    - path: src/validate_data.py
      hash: md5
      md5: 2854aba412786c05fdf81f537502a721
      size: 3620
    outs:
    - path: data/raw/sentinel2_validated.csv
      hash: md5
      md5: c519c4f26f7af5253db247e98abdb84e
      size: 74026
  preprocess:
    cmd: python src/preprocess.py sentinel2_validated.csv processed_features.csv
      scaler.pkl
    deps:
    - path: data/raw/sentinel2_validated.csv
      hash: md5
      md5: c519c4f26f7af5253db247e98abdb84e
      size: 74026
    - path: src/preprocess.py
      hash: md5
      md5: b890b00c6ec29287709eff23709e5902
      size: 2158
    outs:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 84087ae22f7b0cd64f1b5f6f3fe69cc4
      size: 68855
    - path: models/trained_models/scaler.pkl
      hash: md5
      md5: e5c4766858e0f529f3fbd36130105097
      size: 762
  generate_labels:
    cmd: python src/generate_labels.py processed_features.csv labels.csv
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 84087ae22f7b0cd64f1b5f6f3fe69cc4
      size: 68855
    - path: src/generate_labels.py
      hash: md5
      md5: b5a3358bd29745bdddc441e88438e1a1
      size: 3918
    outs:
    - path: data/processed/labels.csv
      hash: md5
      md5: d14cdbe42e590303777990bac58a0861
      size: 89764
  train:
    cmd: python src/train.py params.yaml
    deps:
    - path: data/processed/features_for_training.csv
      hash: md5
      md5: fe3907df672eb2350c26084d01de4cd0
      size: 69985
    - path: data/processed/labels_for_training.csv
      hash: md5
      md5: 9c32481850bb752959e681a1e35ab731
      size: 30289
    - path: src/config.py
      hash: md5
      md5: ea3d905271b3c244627ea217f1f0eab8
      size: 946
    - path: src/generate_labels.py
      hash: md5
      md5: b5a3358bd29745bdddc441e88438e1a1
      size: 3918
    - path: src/model.py
      hash: md5
      md5: e98df45df19d0dce7a21b02c877f1105
      size: 6518
    - path: src/train.py
      hash: md5
      md5: c797d4ae0e80df6e03f3bab58075256d
      size: 7122
    params:
      params.yaml:
        model:
          type: hydrotransnet
          seq_len: 3
          d_model: 128
          nhead: 4
          num_encoder_layers: 8
          dim_feedforward: 512
          dropout: 0.001
          learning_rate: 0.001
          epochs: 100
          batch_size: 10
    outs:
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: ea3de8954267e2eb245d4f3b96118a87
      size: 22889050
    - path: models/trained_models/training_history.pkl
      hash: md5
      md5: 386fd6c1fb1d2400d24701fdc18d1671
      size: 1848
  evaluate:
    cmd: python src/evaluate.py params.yaml
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 84087ae22f7b0cd64f1b5f6f3fe69cc4
      size: 68855
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: ea3de8954267e2eb245d4f3b96118a87
      size: 22889050
    - path: src/evaluate.py
      hash: md5
      md5: 6140b651e51d1bd68f28a77b60064770
      size: 6249
    outs:
    - path: models/trained_models/evaluation_metrics.pkl
      hash: md5
      md5: 0db2ba343e0142ec4855a877479e244e
      size: 415
    - path: models/trained_models/predictions.png
      hash: md5
      md5: e10738d29ca3a35f88d1942d5a919327
      size: 259912
    - path: models/trained_models/residuals.png
      hash: md5
      md5: 6181d85710463b1b6899af00e077b6e5
      size: 294916
    - path: models/trained_models/test_predictions.csv
      hash: md5
      md5: 8332d9e0a3827d70fe75575a650a01d7
      size: 2314
  predict:
    cmd: python src/predict.py
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 84087ae22f7b0cd64f1b5f6f3fe69cc4
      size: 68855
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: ea3de8954267e2eb245d4f3b96118a87
      size: 22889050
    - path: src/model.py
      hash: md5
      md5: e98df45df19d0dce7a21b02c877f1105
      size: 6518
    - path: src/predict.py
      hash: md5
      md5: 017bd10a163e58e03d946b5b814f8795
      size: 3133
    outs:
    - path: models/trained_models/new_predictions.csv
      hash: md5
      md5: c33c8e37056f604e70cff1f02d0a10a5
      size: 37126
  pretrain:
    cmd: python src/pretrain.py data/processed/processed_features.csv 
      data/processed/labels.csv data/processed/features_for_training.csv 
      data/processed/labels_for_training.csv data/processed/feature_scaler.pkl 
      data/processed/label_scaler.pkl
    deps:
    - path: data/processed/labels.csv
      hash: md5
      md5: d14cdbe42e590303777990bac58a0861
      size: 89764
    - path: data/processed/processed_features.csv
      hash: md5
      md5: 84087ae22f7b0cd64f1b5f6f3fe69cc4
      size: 68855
    - path: src/pretrain.py
      hash: md5
      md5: 3f58eb22dcab20187fbd6ae9bfa2b91f
      size: 2794
    outs:
    - path: data/processed/feature_scaler.pkl
      hash: md5
      md5: b2ee848e097a206dcff03106e33c03e2
      size: 767
    - path: data/processed/features_for_training.csv
      hash: md5
      md5: fe3907df672eb2350c26084d01de4cd0
      size: 69985
    - path: data/processed/label_scaler.pkl
      hash: md5
      md5: 325ec530a65c43f150f8ddd1cd4f494a
      size: 799
    - path: data/processed/labels_for_training.csv
      hash: md5
      md5: 9c32481850bb752959e681a1e35ab731
      size: 30289
