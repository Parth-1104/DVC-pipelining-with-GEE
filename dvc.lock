schema: '2.0'
stages:
  fetch_data:
    cmd: python src/fetch_data.py 2023-12-01 2024-04-25 sentinel2_raw.csv
    deps:
    - path: src/config.py
      hash: md5
      md5: 8813314c5ae9328e6169ba873f0015a9
      size: 1048
    - path: src/fetch_data.py
      hash: md5
      md5: c85f8a60464c1fbd2ad975fe164798b8
      size: 3295
    params:
      params.yaml:
        data.end_date: '2024-04-25'
        data.start_date: '2023-12-01'
    outs:
    - path: data/raw/sentinel2_raw.csv
      hash: md5
      md5: d6990dc7d3e0ea87d1cbaba3bc4c989f
      size: 1914
  validate_data:
    cmd: python src/validate_data.py sentinel2_raw.csv sentinel2_validated.csv
    deps:
    - path: data/raw/sentinel2_raw.csv
      hash: md5
      md5: d6990dc7d3e0ea87d1cbaba3bc4c989f
      size: 1914
    - path: src/validate_data.py
      hash: md5
      md5: 2854aba412786c05fdf81f537502a721
      size: 3620
    outs:
    - path: data/raw/sentinel2_validated.csv
      hash: md5
      md5: 6bc58c4a9dd2b03ca3b9ca9ff975e022
      size: 1852
  preprocess:
    cmd: python src/preprocess.py sentinel2_validated.csv processed_features.csv
      scaler.pkl
    deps:
    - path: data/raw/sentinel2_validated.csv
      hash: md5
      md5: 6bc58c4a9dd2b03ca3b9ca9ff975e022
      size: 1852
    - path: src/preprocess.py
      hash: md5
      md5: 52e5bee02354a607afc2248028fd1918
      size: 2073
    outs:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: cf67dcfa52529624d59003935097064f
      size: 3218
    - path: models/trained_models/scaler.pkl
      hash: md5
      md5: d6a2c4ab25ae4265ac3deac811519e3a
      size: 618
  generate_labels:
    cmd: python src/generate_labels.py processed_features.csv labels.csv
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: cf67dcfa52529624d59003935097064f
      size: 3218
    - path: src/generate_labels.py
      hash: md5
      md5: 2da96550dde5d4c4d4686a44e08fe1df
      size: 4048
    outs:
    - path: data/processed/labels.csv
      hash: md5
      md5: 104e827e54eec26ac3a3933fa6b195fa
      size: 3159
  train:
    cmd: python src/train.py params.yaml
    deps:
    - path: data/processed/labels.csv
      hash: md5
      md5: 104e827e54eec26ac3a3933fa6b195fa
      size: 3159
    - path: data/processed/processed_features.csv
      hash: md5
      md5: cf67dcfa52529624d59003935097064f
      size: 3218
    - path: src/config.py
      hash: md5
      md5: 8813314c5ae9328e6169ba873f0015a9
      size: 1048
    - path: src/generate_labels.py
      hash: md5
      md5: 2da96550dde5d4c4d4686a44e08fe1df
      size: 4048
    - path: src/model.py
      hash: md5
      md5: 196e09820b432fa3330bf94877600673
      size: 6484
    - path: src/train.py
      hash: md5
      md5: 98b98c5ae050674095bcc4e395eac602
      size: 8877
    params:
      params.yaml:
        model:
          type: hydrotransnet
          seq_len: 3
          d_model: 128
          nhead: 4
          num_encoder_layers: 8
          dim_feedforward: 512
          dropout: 0.01
          learning_rate: 0.001
          epochs: 100
          batch_size: 4
    outs:
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: a10c727f3e657a0a7d6e49bc45f70031
      size: 9066300
    - path: models/trained_models/training_history.pkl
      hash: md5
      md5: 9f3e3809505ee652626cbac4d7751c40
      size: 336
  evaluate:
    cmd: python src/evaluate.py params.yaml
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: cf67dcfa52529624d59003935097064f
      size: 3218
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: a10c727f3e657a0a7d6e49bc45f70031
      size: 9066300
    - path: src/evaluate.py
      hash: md5
      md5: 6de66efd2f00ef26c834b2e03c2c5439
      size: 6154
    outs:
    - path: models/trained_models/evaluation_metrics.pkl
      hash: md5
      md5: 18dfce071908f19ce7a3b5da1f825ddd
      size: 415
    - path: models/trained_models/predictions.png
      hash: md5
      md5: 556ea4023198b77d455415f8d2c04267
      size: 182400
    - path: models/trained_models/residuals.png
      hash: md5
      md5: 79469e74dd3b3a27bbda64061148e0f9
      size: 139843
    - path: models/trained_models/test_predictions.csv
      hash: md5
      md5: 5b62de9d186bf5285458e1b428297e22
      size: 125
  predict:
    cmd: python src/predict.py
    deps:
    - path: data/processed/processed_features.csv
      hash: md5
      md5: cf67dcfa52529624d59003935097064f
      size: 3218
    - path: models/trained_models/best_model.pt
      hash: md5
      md5: a10c727f3e657a0a7d6e49bc45f70031
      size: 9066300
    - path: src/model.py
      hash: md5
      md5: 196e09820b432fa3330bf94877600673
      size: 6484
    - path: src/predict.py
      hash: md5
      md5: 235366e7abdff9911aa8ea13a8a862cb
      size: 2799
    outs:
    - path: models/trained_models/new_predictions.csv
      hash: md5
      md5: f3563443bc16d65691053cf4e6ba7a98
      size: 882
